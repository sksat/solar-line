<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>DuckDB Explorer Example</title>
<style>
body { background: #0d1117; color: #c9d1d9; font-family: sans-serif; max-width: 1000px; margin: 0 auto; padding: 20px; }
h1, h2 { color: #58a6ff; }
.card { background: #161b22; border: 1px solid #30363d; border-radius: 6px; padding: 16px; margin: 16px 0; }
.explorer-status { padding: 0.5rem 1rem; border-radius: 4px; background: #1f2937; color: #58a6ff; font-size: 0.9rem; }
.explorer-status.explorer-error { color: #f85149; background: #2d1518; }
.explorer-presets { display: flex; flex-wrap: wrap; gap: 0.5rem; }
.preset-btn { background: #21262d; color: #c9d1d9; border: 1px solid #30363d; border-radius: 4px; padding: 0.4rem 0.8rem; cursor: pointer; font-size: 0.85rem; }
.preset-btn:hover { border-color: #58a6ff; color: #58a6ff; }
.explorer-query { width: 100%; background: #0d1117; color: #c9d1d9; border: 1px solid #30363d; border-radius: 4px; padding: 0.75rem; font-family: monospace; font-size: 0.9rem; resize: vertical; box-sizing: border-box; }
.explorer-query:focus { outline: none; border-color: #58a6ff; }
.explorer-input-wrap { display: flex; flex-direction: column; gap: 0.5rem; }
.explorer-actions { display: flex; gap: 0.5rem; }
.explorer-btn { background: #238636; color: #fff; border: 1px solid #2ea043; border-radius: 4px; padding: 0.4rem 1rem; cursor: pointer; font-size: 0.85rem; }
.explorer-btn:hover { background: #2ea043; }
.explorer-btn-secondary { background: #21262d; color: #c9d1d9; border-color: #30363d; }
.explorer-btn-secondary:hover { background: #30363d; }
.explorer-table-wrap { overflow-x: auto; max-height: 500px; overflow-y: auto; }
.explorer-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
.explorer-table th { background: #161b22; position: sticky; top: 0; padding: 0.4rem 0.6rem; border-bottom: 2px solid #30363d; text-align: left; white-space: nowrap; }
.explorer-table td { padding: 0.3rem 0.6rem; border-bottom: 1px solid #21262d; max-width: 300px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.explorer-table tr:hover td { background: #161b22; }
.explorer-result-meta { color: #8b949e; font-size: 0.85rem; margin-bottom: 0.5rem; }
.explorer-empty { color: #8b949e; font-style: italic; }
.null-val { color: #484f58; font-style: italic; }
.explorer-chart-area { margin: 1rem 0; }
.uplot-chart { overflow-x: auto; }
.uplot-chart .uplot-target { margin: 0 auto; }
.uplot-chart .u-legend { font-size: 0.85rem; }
</style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uplot@1.6.32/dist/uPlot.min.css" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/uplot@1.6.32/dist/uPlot.iife.min.js" crossorigin="anonymous"></script>
</head>
<body>
<h1>DuckDB-WASM Explorer Example</h1>
<p>Standalone test page for the DuckDB-WASM data explorer component.</p>

<div class="card">
<div id="explorer-status" class="explorer-status">初期化中…</div>
</div>

<div class="card">
<h3>プリセットクエリ</h3>
<div id="explorer-presets" class="explorer-presets"></div>
</div>

<div class="card">
<h3>SQL クエリ</h3>
<div class="explorer-input-wrap">
<textarea id="explorer-query" class="explorer-query" rows="4">SELECT episode, id, description, computedDeltaV AS dv_km_s, verdict FROM transfers ORDER BY episode, id</textarea>
<div class="explorer-actions">
<button id="explorer-exec" class="explorer-btn">実行 (Ctrl+Enter)</button>
<button id="explorer-schema" class="explorer-btn explorer-btn-secondary">スキーマ表示</button>
</div>
</div>
</div>

<div id="explorer-chart" class="explorer-chart-area"></div>
<div id="explorer-result" class="explorer-result"></div>

<!-- This example uses inline test data instead of fetching explorer-data.json -->
<meta name="base-path" content="..">
<script>
// Override the data URL for standalone testing with inline data
window.__EXPLORER_TEST_DATA = {
  generatedAt: new Date().toISOString(),
  transfers: [
    { id: "ep01-transfer-01", episode: 1, description: "ホーマン遷移基準値: 火星→木星", timestamp: "N/A", claimedDeltaV: null, computedDeltaV: 10.15, verdict: "reference", assumptionCount: 4, sourceCount: 2, hasReproductionCommand: true },
    { id: "ep01-transfer-02", episode: 1, description: "72時間高速遷移: 火星→木星", timestamp: "01:30", claimedDeltaV: null, computedDeltaV: 8497.39, verdict: "conditional", assumptionCount: 5, sourceCount: 3, hasReproductionCommand: true },
    { id: "ep02-transfer-01", episode: 2, description: "ホーマン遷移基準値: 木星→土星", timestamp: "N/A", claimedDeltaV: null, computedDeltaV: 3.36, verdict: "reference", assumptionCount: 4, sourceCount: 2, hasReproductionCommand: true },
    { id: "ep03-transfer-01", episode: 3, description: "ホーマン遷移基準値: 土星→天王星", timestamp: "N/A", claimedDeltaV: null, computedDeltaV: 2.74, verdict: "reference", assumptionCount: 4, sourceCount: 2, hasReproductionCommand: true },
  ],
  dialogue: [
    { episode: 1, lineId: "ep01-dl-001", speakerId: "kiritan", speakerName: "きりたん", text: "テストセリフ", startMs: 0, endMs: 5000, confidence: "high", sceneId: "scene-01" },
    { episode: 1, lineId: "ep01-dl-002", speakerId: "kei", speakerName: "ケイ", text: "応答テスト", startMs: 5000, endMs: 10000, confidence: "high", sceneId: "scene-01" },
  ],
  dagNodes: [
    { id: "src.worldbuilding", label: "設定資料", type: "data_source", status: "valid" },
    { id: "param.ship_mass", label: "船の質量", type: "parameter", status: "valid" },
  ],
  dagEdges: [
    { from: "src.worldbuilding", to: "param.ship_mass" },
  ],
};
</script>
<script src="../src/duckdb-explorer.js"></script>
</body>
</html>
