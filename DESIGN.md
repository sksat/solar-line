# SOLAR LINE 考察

SOLAR LINE はゆえぴこ氏が制作・公開している『良いソフトウェアトーク劇場』の SF シリーズ長編。

ニコニコ: https://www.nicovideo.jp/user/5844196/series/531506
YouTube: https://www.youtube.com/playlist?list=PLsrZ6S47a4FuZHMV5_F6ePsOd3AZ5h_xX

このシリーズでは、太陽系内を宇宙船で駆け巡る描写がたくさんある。この描写では、ΔV など軌道力学的な要素が多くある。
この描写の妥当性を考察すると共に、妥当な場合はどのような条件（適切な天体位置になる時刻、各話各点火描写前の軌道など）であれば描写が成立するかをできるだけ調査するのがこのリポジトリの目的。

調査結果はその問題の大小を問わず、なんらかの形で GitHub Pages から見られるようにする。

GitHub Pages にあるべきものは例えば以下のようなもの
- 各調査に紐付いた Claude Code session のログ
- 各軌道遷移ごとおよび全話での軌道遷移調査レポート。インタラクティブな再現ができるとなおよい。

調査に当たっては、以下のような基盤を整えて進めるとよい。
- Claude Code session log 収集 + Web page 化
- 各話の動画内容および YouTube などにある字幕データの収集スクリプト
  - 収集した生データは gitignore しておくこと
  - ニコニコ動画のコメントは字幕ではないことに留意すること
  - 各レポートでは、適宜必要なものの引用をしてよい。ただし引用の要件を満たすこと。
  - 台詞については、どのキャラクターがいつどんな発言をしたかが重要になってくる。ここについては全自動で行うのではなく、Claude もしくは Codex が文脈を把握することで、正確な発話者を明らかにしておくこと。
    - 文脈や画面、曲調の変化から場面転換を把握すること
  - 台詞パイプラインは2フェーズに分離すること:
    - Phase 1（台詞抽出）: 字幕から発言テキストとタイムスタンプを抽出する。自動化可。出力: `epXX_lines.json`
    - Phase 2（話者判定）: 抽出された台詞に対し、文脈を元に話者を振り分ける。全自動にはしない。出力: `epXX_dialogue.json`
    - ファイルを分けることで、台詞抽出を再度走らせても話者判定の作業が無駄にならない
  - タイムスタンプの精度にも注意を払うこと。複数字幕トラックの照合や、動画内容との整合性確認を行う

解析には Typescript や Rust を用いること。Rust を用いた解析をした場合は、レポートには手元で動作させた解析結果を貼るか、wasm にビルドしてレポートでの再現が可能になるようにすること。
プログラムの開発には TDD のアプローチを取ること。期待する挙動などの仕様をできるだけテストという形で記述することで、プロジェクトが成長してもガードが敷かれるような状態を維持すること。
また、そのテストは CI で常に検証されるようにすること。適宜 CI status を確認することで、うっかり壊してしまったモノを直すことができる。

plan を決める時など、他の意見があるとより精度が高まるような場面では適宜 nice-friend にも相談しながら進める。

元の生データや信頼できる機関から取得したパラメータなど以外は常に信用できるものとは限らないことに気をつける。
そのため、そのレポートやコードがどんな仮定を置いていたかが非常に重要となる。適宜コメントなどを付記したり、付記できるような構造を作っておくこと。

分析において不整合が見つかった場合、単に「非現実的」と結論づけて終わるのではなく、複数のパラメータパターンを想定し、どのパラメータがどうであれば描写が成立するかを議論すること。例えば、質量が異なったら？推力が異なったら？軌道条件が異なったら？という形で可能性の空間を探索し、境界条件や妥当な解釈を提示する。

また、分析で用いるパラメータ（船の質量、推力、軌道半径等）にはすべて出典を明記すること。エピソードのタイムスタンプ、世界設定資料の URL などが根拠となる。出典のないパラメータは分析の信頼性を損なう。

軌道遷移の分析では、ΔV の計算だけでなく、目的天体が実際に到達可能な位置にあるかどうかも検証すること。諸条件から整合する惑星の位置関係を想定し、そこから作中の太陽系日時も計算する。

後のエピソードの解析から明らかになった事実は、解析に使えるデータないし文脈として既存のレポートに追記・清書してよい。各レポートは孤立した分析ではなく、シリーズ全体の文脈の中で相互に参照し合うこと。

クロスエピソード分析はエピソード間比較だけでなく、各船の仕様、技術的整合性、ルート最適性など、エピソード以外の観点からも柔軟に行ってよい。

インタラクティブ軌道遷移グラフにはエンジン点火の描写を含めること。推力フェーズの可視化によりダイアグラムの情報量と直感的理解を高める。

このプロジェクトは Claude Code によるエージェントループによって開発を行う。
そのセッションだけですべての問題を解決しようとせず、問題を切り出してステップバイステップで問題を解決し、次のセッションへ問題解決を引き継ぐこと。
リポジトリ内のファイルへのメモや、commit message が重要となる。

current_tasks/ に現在取り組んでいるタスクとその状況をメモし、取り組んでいる中で新たに出てきたアイデアを ideas/ にメモしておくこと。これらのファイルは commit してよい。

## 考察の観点

SF 作品なので、人間に対する加速度の影響への対策や、現在ではありえない推進器性能は許容される前提。それよりも作中の描写として自然かどうかの観点を重視すること。経過時間・航行距離・天体位置の整合性が重要。

作中の登場人物が別の判断をしていた場合の IF（反事実分析）も行うと考察が深まる。例: 木星フライバイなしの直行ルート、ノズル温存のための低推力航路、など。

## 数式レンダリング

レポートに含まれる数式は、読者にとって見やすくレンダリングされること。KaTeX または MathJax の導入を検討する。

## 軌道伝搬による検証

大雑把な机上計算（Brachistochrone ΔV、ホーマン遷移など）による分析の後に、詳細な数値軌道伝搬を行って検証すること。特に、時間経過や惑星位置などの細かいパラメータについては、伝搬計算による裏付けがあると信頼性が高まる。

数値積分手法の精度の見積りおよび検証も行いながら、TDD のアプローチで開発すること。検証には系全体でのエネルギー保存などを指標にするとよい。

## 出典のリンク化

外部出典（NASA NTRS、論文、世界設定資料等）はクリックで踏めるリンクとして表示すること。プレーンテキストではなくハイパーリンクにする。

## 判定ポリシー

参考計算（作中の描写値と直接比較できない値）には「判定不能」フラグを付けない。判定は作中描写との直接比較が可能なものに限定する。

## 文字起こしとデータ管理

- Whisper のモデル（tiny/base/small/medium/large）によって精度が変わる。どんな条件（モデル、言語設定等）で生成した字幕データかを構造的に管理すること。YouTube から取得したデータも同様に条件を記録する。
- Whisper 以外の STT 手段（Google Speech-to-Text、Azure Speech 等）も精度に不安がある場合は検討してよい。
- 話者分離（Speaker Diarization）技術を併用すると、Phase 2 の話者判定精度が向上する可能性がある。
- 動画は gitignore したディレクトリにダウンロードし、字幕抽出や画面分析（OCR等）に利用してよい。
- 字幕抽出・文字起こしデータは GitHub Pages で閲覧可能にすること。

## 軌道遷移図の拡張

- 軌道遷移に複数パターンがある場合、ひとつの軌道遷移図で複数パターンを同時にアニメーションさせると比較がわかりやすい。

## E2E テスト

Markdown の表が壊れるなど、レポートの表示が壊れることがある。Playwright E2E テストを導入して表示の品質を自動検証すること。Playwright CLI も活用すること。

## ワークフローの Skill 化

よく行う作業パターン（字幕抽出、エピソード分析、レポートレビュー等）は Claude Code の Skill として定義し、再利用可能にすること。Anthropic のベストプラクティスに従う。Anthropic 公式の Skill（frontend-skill 等）も利用してよい。

## GitHub Pages でのリポジトリリンク

Pages サイトには、ソースコードの GitHub リポジトリへのリンクを明示すること。

## Session Log の改善

Claude Code session log は以下の要件を満たすこと:
- agent-loop の標準出力のサマリー的なものと、conversation log は分けて表示する
- conversation log では、アシスタントは「Assistant (model)」のように表記する
- sub-agent にもできれば対応する
- どの commit と紐付いているかを明示し、GitHub にリンクする

## 分析の読みやすさ

各分析は SOLAR LINE をあまり知らない人や、見たけど軌道力学には詳しくない人にも伝わるかという観点でたまにレビューすること。ただし、詳細な分析が主目的なので、平易になりすぎても仕方ないことに注意する。

## スクリーンショット引用

画面からの分析を行った場合はそのスクリーンショットを引用してもよい。ただし引用の要件を満たすため、やりすぎには注意すること。

## 適応的積分手法

固定 dt の RK4 は推進器の点火・消火や重力アシスト時の近接遭遇など、加速度が急変する場面には不利。TDD で複数の積分手法を実装・比較すること:
- RK45 (Dormand-Prince): 埋め込み型適応ステップ
- シンプレクティック積分（Störmer-Verlet）: 長期エネルギー保存に優れる
- 効率（同精度で必要なステップ数）を比較し、場面に応じた最適手法を選択する

## 姿勢制御精度の考察

高推力 brachistochrone 機動や精密航法に必要な姿勢制御精度を分析する:
- 推力ベクトル指向精度とミス距離の関係
- フリップ機動（180° 回転）のダイナミクス
- EP03 精度 99.8% が暗示する指向精度
- 推力低下（EP04）やノズル損傷（EP05）の姿勢への影響

## 通信の考察

作中には通信描写が多い。その物理的妥当性を考察する:
- 光速遅延: 各エピソードの距離での通信遅延
- リンクバジェット: 深宇宙距離での通信可能性（DSN を参考値とする）
- 通信ブラックアウト: 太陽合など
- 作中の「リアルタイム」会話と物理的遅延の矛盾の有無

## マージン可視化

各話の「ギリギリ」な場面を視覚的にわかりやすく伝えるため、以下の可視化を行う:
- 時系列チャート（横軸: 時間）: 推力プロファイル、合計被曝量、ノズル残寿命
- 比較パターン: 典型的な他パターン（余裕のある航路、もっと危険な航路）を並べて差を明示する
- ゲージ/バーチャート: 各パラメータが限界値にどこまで近づいたかを一目で示す

## 惑星配置の整合

軌道遷移アニメーションでは、想定される劇中時期のエポックに基づいた惑星配置を反映すること。
特にクロスエピソード分析の全航路図では、惑星が「ありえない」配置にあると航路が接続して見えなくなる。
ephemeris モジュール（既存）を活用し、ダイアグラムにエポック表記を含めること。

## 3次元軌道解析

2次元計算で基礎的な分析ができたら、軌道傾斜角を考慮した3次元解析にも進むこと:
- 各惑星の軌道傾斜角を含めた遷移軌道の計算
- 土星の輪との位置関係（通過可能性）
- 天王星の極端な軸傾斜（97.8°）がアプローチ幾何に与える影響
- エンケラドス軌道と土星環面との関係

## 外乱解析

プラズモイドなどの宇宙環境による外乱の影響を見積もること:
- プラズモイド遭遇時の運動量・エネルギー変化の推定
- 軌道偏差と補正ΔVの計算
- 生物学的影響（放射線量）と力学的影響（軌道変化）の区別

## 物理学相談

物理学的な考察の相談には -codex モデルではなく gpt-5.2 等の推論モデルを用いること。
設計・アーキテクチャの相談には引き続き -codex を使用。

## レポートのネスト構造

分析が長くなった場合、レポートの切り分けやネスト（子レポート）を検討してよい:
- ネストの深さに注意すること
- ヘッダレベルをネスト深度と整合させること
- パンくずリスト・戻りリンクで親子間のナビゲーションを保つこと

## 文字起こしデータの多層表示

文字起こしデータは以下の3層を区別して表示すること:
- 第1層: 生データ（YouTube VTT / Whisper 出力、無修正）
- 第2層: 前処理済み（タイムスタンプ整列、話者分離等）
- 第3層: 文脈修正済み（話者帰属、テキスト修正）
Whisper のモデルサイズ（tiny/base/small/medium/large）もメタデータとして記載すること。

## 人間からの指示履歴

どのタイミングで人間からどんな追加指示があったかを `human_directives_history.md` にまとめておく。